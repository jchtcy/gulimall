# 一、虚拟机
## 1、安装虚拟机
````
网上找, VMware虚拟机安装Ubuntu
````
## 2、虚拟机配置远程连接
### 1、Ubuntu 启动SSH服务
````
Ubuntu 启动SSH服务
sudo apt-get install openssh-server

检查SSH服务是否启动命令
ps -e |grep ssh
````
### 2、配置root登录
````
gedit /etc/ssh/sshd_config
在第34行添加 PermitRootLogin yes

命令重启ssh服务
service ssh restart
````
# 二、Docker安装
## 1、卸载旧版本
````
for pkg in docker.io docker-doc docker-compose docker-compose-v2 podman-docker containerd runc; do sudo apt-get remove $pkg; done
````
## 2、设置 Docker 的存储库
````
1、软件更新
sudo apt-get update
此时从乌班图官网更新软件失败

2、设置阿里云镜像
备份原来的源
sudo cp /etc/apt/sources.list /etc/apt/sources_init.list

更换源
sudo gedit /etc/apt/sources.list

更换为以下内容
deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse

3、添加 Docker 的官方 GPG 密钥

sudo apt-get install ca-certificates curl gnupg
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg

4、将存储库添加到Apt源

echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update
````
## 3、安装 Docker
````
1、安装Docker包
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

2、启动
sudo systemctl start docker

3、查看Docker的版本
docker version

4、通过运行映像来验证 Docker 引擎安装是否成功
sudo docker run hello-world

5、查看下载的 hello-world 镜像
docker images

6、开机启动docker
systemctl enable docker
````
## 4、卸载 Docker 引擎
````
1、下载依赖
sudo apt-get purge docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras

2、删除资源
rm -rf /var/lib/docker
# /var/lib/docker docker的默认工作路径
````
## 5、Docker配置阿里云
````
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://f214zc7d.mirror.aliyuncs.com"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
````
# 三、docker安装开发环境
## 1、docker中安装mysql
````
下载镜像: docker pull mysql:5.7

查看镜像: docker images

启动mysql: sudo docker run -p 3306:3306 --name mysql \
-v /mydata/mysql/log:/var/log/mysql \
-v /mydata/mysql/data:/var/lib/mysql \
-v /mydata/mysql/conf:/etc/mysql \
-e MYSQL_ROOT_PASSWORD=root \
-d mysql:5.7

修改配置: vi /mydata/mysql/conf/my.conf
[client]
default-character-set=utf8
[mysql]
default-character-set=utf8
[mysqld]
init_connect='SET collation_connection = utf8_unicode_ci'
init_connect='SET NAMES utf8'
character-set-server=utf8
collation-server=utf8_unicode_ci
skip-character-set-client-handshake
skip-name-resolve

重启容器使配置生效: docker restart mysql

mysql自动启动: docker update mysql --restart=always
````
## 2、docker中安装redis
````
下载镜像: docker pull redis

创建实例并启动: 
mkdir -p /mydata/redis/conf
touch /mydata/redis/conf/redis.conf
docker run -p 6379:6379 --name redis \
-v /mydata/redis/data:/data \
-v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \
-d redis redis-server /etc/redis/redis.conf

数据持久化: 
vi /mydata/redis/conf/redis.conf
appendonly yes

重启redis使配置生效: docker restart redis

redis自动启动: docker update redis --restart=always
````
# 四、本地开发环境
## 1、idea
````
IDEA安装插件lombok，mybatisX。
IDEA设置里配置好maven
````
## 2、vsCode
````
Auto Close Tag
Auto Rename Tag
Chinese
HTML CSS Support
JavaScript ES6
Live Server
open in brower
Vetur
````
# 五、git
````
网上找, idea配置github提交项目代码
````
# 六、项目结构创建
## 1、新建github项目
````
仓库名gulimall
gitignore选中maven
许可证选Apache-2.0
创建两个分支: main(生产)和dev(开发)
````
## 2、从github上下拉项目
## 3、创建微服务模块
````
商品服务product
存储服务ware
订单服务order
优惠券服务coupon
用户服务member

导入web和openFeign
group：com.atguigu.gulimall
Artifact：gulimall-XXX
每一个服务，包名com.atguigu.gulimall.XXX{product/order/ware/coupon/member}
模块名：gulimall-XXX
````
## 4、父pom文件
````
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.atguigu.gulimall</groupId>
    <artifactId>gulimall</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>gulimall</name>
    <description>聚合服务</description>

    <packaging>pom</packaging>

    <modules>
        <module>gulimall-coupon</module>
        <module>gulimall-member</module>
        <module>gulimall-order</module>
        <module>gulimall-product</module>
        <module>gulimall-ware</module>
    </modules>

</project>
````
## 5、修改总项目的.gitignore, 加入以下内容
````
**/mvnw
**/mvnw.cmd
**/.mvn
**/target/
.idea
**/.gitignore
````
## 6、修改每个服务中spring boot和spring cloud的版本
````
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>2.3.2.RELEASE</version>
    <relativePath   />
</parent>

<properties>
    <java.version>1.8</java.version>
    <spring-cloud.version>Hoxton.SR6</spring-cloud.version>
</properties>
````
# 七、数据库
````
创建数据库分别运行sql下的脚本
````
# 八、人人开源搭建后台管理系统
## 1、后端
````
1、下载项目
git clone https://gitee.com/renrenio/renren-fast.git

2、在父pom文件中添加
<module>renren-fast</module>

3、renren-fast的pom文件修改为
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>2.3.2.RELEASE</version>
    <relativePath   />
</parent>

4、创建gulimall_admin数据库, 运行gulimall_admin.sql

5、修改application-dev.yml中的数库库的url
url: jdbc:mysql://192.168.48.129:3306/gulimall_admin?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
username: root
password: root

6、启动项目报错:
java: 找不到符号
  符号:   方法 allowedOriginPatterns(java.lang.String)
  位置: 类 org.springframework.web.servlet.config.annotation.CorsRegistration
将allowedOriginPatterns换成allowedOrigins

7、此时启动renren-fast,访问http://localhost:8080/renren-fast/
得到{“msg”:“invalid token”,“code”:401}就代表无误
````
## 2、前端
````
1、安装nvm管理nodejs版本, 本项目用10.16.3

2、安装node10.16.3

3、切换国内镜像源 npm config set registry https://registry.npmmirror.com

4、下载前端项目: git clone https://gitee.com/renrenio/renren-fast-vue.git

5、下载文件https://cdn.npm.taobao.org/dist/chromedriver/2.27/chromedriver_win32.zip

6、执行: npm install chromedriver --chromedriver_filepath=D:\安装包\chromedriver_win32.zip

7、修改项目文件 package.json 中的 saas 版本（不用太高也不能太低）
"node-sass": "4.13.1",
"sass-loader": "7.3.1",

10、安装依赖: npm install

11、启动项目: npm run dev

12、访问 http://localhost:8001/#/login 成功
````
## 3、代码生成器
````
1、下载代码: git clone https://gitee.com/renrenio/renren-generator.git

2、在父pom文件中添加
<module>renren-generator</module>

3、renren-fast的pom文件修改为
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>2.3.2.RELEASE</version>
    <relativePath   />
</parent>
````
## 4、使用代码生成器生成代码(以product模块为例, 其他模块类似)
````
1、修改代码生成器模块下 application-dev.yml中的数库库的url
url: jdbc:mysql://192.168.48.129:3306/gulimall_pms?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
username: root
password: root

2、修改generator.properties
#代码生成器，配置信息
mainPath=com.jch
#包名
package=com.jch.gulimall
moduleName=product
#作者
author=jch
#Email
email=jch@gulimall.com
#表前缀(类名不会包含表前缀)
tablePrefix=pms_

3、将生成的代码放到product

4、此时缺少一些依赖, 创建common模块

5、修改gulimall-common的pom文件
<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>gulimall</artifactId>
        <groupId>com.atguigu.gulimall</groupId>
        <version>0.0.1-SNAPSHOT</version>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>gulimall-common</artifactId>
    <description>公共模块</description>

    <dependencies>
        <!-- mybatisPLUS-->
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-boot-starter</artifactId>
            <version>3.3.2</version>
        </dependency>
        <!--简化实体类，用@Data代替getset方法-->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <version>1.18.8</version>
        </dependency>
        <!-- httpcomponent包。发送http请求 -->
        <dependency>
            <groupId>org.apache.httpcomponents</groupId>
            <artifactId>httpcore</artifactId>
            <version>4.4.13</version>
        </dependency>
        <dependency>
            <groupId>commons-lang</groupId>
            <artifactId>commons-lang</artifactId>
            <version>2.6</version>
        </dependency>
    </dependencies>
</project>

6、在product项目中的pom.xml中加入下面内容，作为common的子项目
<dependency>
    <groupId>com.jch.gulimall</groupId>
    <artifactId>gulimall-common</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</dependency>

7、将需要的工具类从io/renren/common 复制到 java/com/jch/common下

8、注释掉shiro相关代码
````
## 5、整合mybatisplus(以product模块为例, 其他模块类似)
````
1、在common的pom.xml中导入
<!-- 数据库驱动 https://mvnrepository.com/artifact/mysql/mysql-connector-java -->
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>8.0.17</version>
</dependency>
<!--tomcat里一般都带-->
<dependency>
    <groupId>javax.servlet</groupId>
    <artifactId>servlet-api</artifactId>
    <version>2.5</version>
    <scope>provided</scope>
</dependency>

2、在product项目的resources目录下新建application.yml
spring:
  datasource:
    username: root
    password: root
    url: jdbc:mysql://192.168.48.129:3306/gulimall_pms?useUnicode=true&characterEncoding=UTF-8&useSSL=false&serverTimezone=Asia/Shanghai
    driver-class-name: com.mysql.jdbc.Driver

# MapperScan
# sql映射文件位置
mybatis-plus:
  mapper-locations: classpath:/mapper/**/*.xml
  global-config:
    db-config:
      id-type: auto

server:
  port: 10000

      
3、然后在主启动类上加上注解@MapperScan()
@MapperScan("com.jch.gulimall.product.dao")

4、运行测试类, 往数据库添加数据
@SpringBootTest
class GulimallProductApplicationTests {

    @Autowired
    BrandService brandService;

    @Test
    void contextLoads() {
        BrandEntity brandEntity = new BrandEntity();
        brandEntity.setName("华为");
        brandService.save(brandEntity);
        System.out.println("保存成功");
    }

}
````
## 6、参照product, 生成其他微服务的代码
````
端口号:
coupon: 7000
member: 8000
order: 9000
product: 10000
ware: 11000
````

